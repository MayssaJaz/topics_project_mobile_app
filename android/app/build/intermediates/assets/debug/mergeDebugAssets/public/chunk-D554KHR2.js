import{a as re}from"./chunk-4SWIPSKG.js";import{a as ae,c as le,i as se}from"./chunk-7KEMS7IJ.js";import{a as R,x as ne,y as oe}from"./chunk-W6UDVYDR.js";import{$ as _,$a as F,$b as te,A as g,B as h,Ea as J,Eb as W,Fb as k,Ga as v,J as D,Jb as V,Ka as x,L as $,M as s,P as y,Pb as X,Sb as Z,T as S,V as l,Va as b,Vb as ee,Wa as K,Wb as M,Xa as E,Xb as G,Ya as B,Z as i,Za as q,_ as r,_a as P,aa as z,ab as Q,ac as ie,ba as H,da as A,db as T,ea as d,fa as C,fb as w,j as O,m as j,ma as L,na as p,u as c,ya as Y,yb as N,zb as I}from"./chunk-KG5FX6JE.js";import"./chunk-EQWFYTHX.js";import"./chunk-QPPST4YU.js";import"./chunk-IXFPWM3A.js";import"./chunk-3BFGMDL6.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-QXT6YJJ4.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{g as f}from"./chunk-OLRFWS6T.js";function pe(a,n){a&1&&(i(0,"p",8),p(1," Please select an image file. "),r())}var me=(()=>{let n=class n{constructor(){this.fb=c(T),this.modalCtrl=c(G),this.toastService=c(ne),this.storageService=c(re),this.selectedFile=null}ngOnInit(){this.pictureForm=this.fb.group({image:[null,b.required]})}onFileSelected(t){var o;let e=t.target;e.files&&e.files.length>0&&(this.selectedFile=e.files[0],this.pictureForm.patchValue({image:this.selectedFile}),(o=this.pictureForm.get("image"))==null||o.updateValueAndValidity())}cancel(){this.modalCtrl.dismiss()}uploadFile(t){return f(this,null,function*(){if(t)try{return yield this.storageService.uploadFile(t)}catch{return this.toastService.presentToast("Error uploading file","danger"),new Error("File upload failed")}return this.toastService.presentToast("No image selected","danger"),new Error("No file selected")})}onSubmit(){return f(this,null,function*(){if(this.pictureForm.valid&&this.selectedFile){let t=yield this.uploadFile(this.selectedFile);if(t instanceof Error)return;this.modalCtrl.dismiss(t)}})}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=y({type:n,selectors:[["app-add-picture"]],decls:14,vars:5,consts:[[3,"ngSubmit","formGroup"],["slot","start"],["color","medium",3,"click"],["slot","end"],["type","submit",3,"disabled","strong"],[1,"ion-padding",3,"fullscreen"],["type","file","accept","image/*",3,"change"],["class","error",4,"ngIf"],[1,"error"]],template:function(e,o){e&1&&(i(0,"form",0),d("ngSubmit",function(){return o.onSubmit()}),i(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1)(4,"ion-button",2),d("click",function(){return o.cancel()}),p(5,"Cancel"),r()(),i(6,"ion-title"),p(7,"Add Picture"),r(),i(8,"ion-buttons",3)(9,"ion-button",4),p(10,"Confirm"),r()()()(),i(11,"ion-content",5)(12,"input",6),d("change",function(U){return o.onFileSelected(U)}),r(),S(13,pe,2,0,"p",7),r()()),e&2&&(l("formGroup",o.pictureForm),s(9),l("disabled",o.pictureForm.invalid)("strong",!0),s(2),l("fullscreen",!0),s(2),l("ngIf",o.pictureForm.controls.image.invalid&&o.pictureForm.controls.image.touched))},dependencies:[x,v,w,P,E,F,k,V,M,N,I,ee],encapsulation:2});let a=n;return a})();function fe(a,n){if(a&1){let m=A();z(0),i(1,"div",6),d("click",function(){g(m);let e=C();return h(e.editProfilePicture())}),_(2,"img",7),i(3,"div",8),_(4,"ion-icon",9),r()(),i(5,"form",10),d("ngSubmit",function(){g(m);let e=C();return h(e.onSubmit())}),_(6,"ion-input",11)(7,"ion-input",12),i(8,"ion-button",13),d("click",function(){g(m);let e=C();return h(e.forgotPassword())}),p(9,"Reset your password?"),r(),i(10,"ion-row",14)(11,"ion-col",15)(12,"ion-button",16),d("click",function(){g(m);let e=C();return h(e.cancel())}),p(13,"Cancel"),r()(),i(14,"ion-col",15)(15,"ion-button",17),p(16," Confirm "),r()()()(),H()}if(a&2){let m=C();s(2),l("src",m.logoSrc,$),s(3),l("formGroup",m.userForm),s(),l("errorText",m.nameErrorText()),s(),l("errorText",m.familyNameErrorText()),s(8),l("disabled",m.userForm.invalid)}}function ge(a,n){a&1&&(i(0,"div",18),_(1,"ion-spinner"),r())}ae({createOutline:se,arrowBack:le});var Ae=(()=>{let n=class n{constructor(){this.fb=c(T),this.location=c(J),this._authService=c(oe),this.name="",this.familyName="",this.uid="",this.logo="",this.email="",this.modalCtrl=c(G),this.loading=D(!0),this.userForm=this.fb.group({name:["",[b.required]],familyName:["",[b.required]]}),this.nameErrorText$=this.userForm.events.pipe(j(t=>t instanceof q||t instanceof B),O(()=>{var t,e;return(t=this.userNameControl)!=null&&t.errors&&((e=this.userNameControl)!=null&&e.errors.required)?"This field is required":""})),this.familyNameErrorText$=this.userForm.events.pipe(j(t=>t instanceof q||t instanceof B),O(()=>{var t,e;return(t=this.userNameControl)!=null&&t.errors&&((e=this.userNameControl)!=null&&e.errors.required)?"This field is required":""})),this.nameErrorText=R(this.nameErrorText$),this.familyNameErrorText=R(this.familyNameErrorText$)}get logoSrc(){return this.logo!==""?this.logo:"assets/img/no_logo.jpg"}ngOnInit(){this._authService.getConnectedUser().subscribe(t=>{t&&this._authService.getUserById(t.uid).subscribe(e=>{e&&(this.uid=t.uid,this.name=e.name,this.familyName=e.family_name,this.email=e.email,this.logo=e.logo||"",this.userForm.patchValue({name:this.name,familyName:this.familyName}))}),this.loading.set(!1)})}get userNameControl(){return this.userForm.get("name")}get userFamilyNameControl(){return this.userForm.get("familyName")}cancel(){this.location.back()}onSubmit(){var t,e,o,u;this._authService.editUser(this.uid,(e=(t=this.userNameControl)==null?void 0:t.value)!=null?e:"",(u=(o=this.userFamilyNameControl)==null?void 0:o.value)!=null?u:"")}openModal(){return f(this,null,function*(){let t=yield this.modalCtrl.create({component:me});yield t.present();let{data:e}=yield t.onDidDismiss();e&&(this.logo=e,this._authService.editProfilePicture(this.uid,e))})}editProfilePicture(){this.openModal()}forgotPassword(){return f(this,null,function*(){yield this._authService.sendResetPasswordLink(this.email)})}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=y({type:n,selectors:[["app-edit-profile"]],decls:9,vars:2,consts:[["loadingTemplate",""],["slot","start"],[3,"click"],["name","arrow-back"],[1,"ion-padding"],[4,"ngIf","ngIfElse"],[1,"profile-image-container",3,"click"],["alt","Profile Image",1,"profile-image",3,"src"],[1,"edit-badge"],["name","create-outline"],[3,"ngSubmit","formGroup"],["formControlName","name","fill","solid","label","Edit your name","labelPlacement","floating","placeholder","Your name",3,"errorText"],["formControlName","familyName","fill","solid","label","Edit your family name","labelPlacement","floating","placeholder","Your family name",3,"errorText"],["expand","full","fill","clear",3,"click"],[1,"ion-justify-content-end"],["size","auto"],["color","medium",3,"click"],["type","submit","strong","true",3,"disabled"],[1,"loading-container"]],template:function(e,o){if(e&1){let u=A();i(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),d("click",function(){return g(u),h(o.cancel())}),_(4,"ion-icon",3),r()()()(),i(5,"ion-content",4),S(6,fe,17,5,"ng-container",5)(7,ge,2,0,"ng-template",null,0,Y),r()}if(e&2){let u=L(8);s(6),l("ngIf",!o.loading())("ngIfElse",u)}},dependencies:[X,x,v,w,P,K,E,F,Q,k,V,M,N,I,ie,te,W,Z],styles:[".profile-image-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;flex-direction:column}.profile-image[_ngcontent-%COMP%]{width:100px;height:100px;border-radius:50%;object-fit:cover;border:2px solid white}.edit-badge[_ngcontent-%COMP%]{margin-top:-15px;background-color:#4caf50;color:#fff;width:30px;height:30px;border-radius:50%;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 2px 5px #0003;margin-left:5%}.edit-badge[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:18px}.loading-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh}"]});let a=n;return a})();export{Ae as EditProfilePage};
