import{a as Bt}from"./chunk-CXVPZADV.js";import{a as k,f as Vt,i as At}from"./chunk-ZY6Z6F2D.js";import"./chunk-5KL66UXA.js";import"./chunk-4SWIPSKG.js";import{a as Nt,b as wt,e as Ft,f as Dt,g as Ot,j as Lt}from"./chunk-7KEMS7IJ.js";import"./chunk-GRDTBITF.js";import"./chunk-WNOGYX6W.js";import"./chunk-YMI2B6JE.js";import"./chunk-KPVSGPAK.js";import"./chunk-HC6MZPB3.js";import"./chunk-5IIASHPE.js";import"./chunk-FERD25SW.js";import"./chunk-HMTYJH34.js";import"./chunk-VFZRLGVJ.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-EOWGNRGH.js";import"./chunk-MCRJI3T3.js";import"./chunk-U6BOKI5K.js";import"./chunk-W5O32OXO.js";import{a as C,g as Et,i as St,l as Mt,v as kt,y as yt}from"./chunk-W6UDVYDR.js";import{$ as c,$a as nt,$b as xt,A as v,B as b,Fb as S,Ga as W,Gb as ct,Hb as mt,Ia as J,J as G,Jb as dt,Ka as K,Kb as ut,Lb as _t,M as a,Ma as Q,Mb as ht,N as H,Nb as ft,Oa as U,Ob as gt,P as T,Pa as Y,Rb as vt,T as N,Ub as bt,V as l,Va as P,Vb as Ct,Wa as Z,Wb as Tt,X as R,Xa as tt,Xb as M,Y as X,Ya as et,Yb as It,Z as r,Za as it,_ as s,_a as ot,ab as rt,ac as Pt,da as I,db as at,ea as _,eb as st,fa as h,fb as lt,h as L,j as V,m as B,ma as j,na as f,o as A,p as $,pa as w,sa as q,u as d,ua as g,va as x,xa as F,ya as z,yb as E,zb as pt}from"./chunk-KG5FX6JE.js";import"./chunk-EQWFYTHX.js";import"./chunk-QPPST4YU.js";import"./chunk-IXFPWM3A.js";import"./chunk-3BFGMDL6.js";import"./chunk-G3CV3VGG.js";import"./chunk-PXSONQDE.js";import"./chunk-MS5FDQK3.js";import"./chunk-GCVURZBX.js";import"./chunk-4U6PRYVA.js";import"./chunk-QXT6YJJ4.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{a as D,b as O,g as y}from"./chunk-OLRFWS6T.js";var $t=(()=>{let n=class n{constructor(){this.topicService=d(k),this.fb=d(at),this.modalCtrl=d(M),this.DESCRIPTION_MAX_LENGTH=1e3,this.NAME_MIN_LENGTH=3,this.postForm=this.fb.group({name:["",[P.required,P.minLength(this.NAME_MIN_LENGTH)]],description:["",[P.maxLength(this.DESCRIPTION_MAX_LENGTH)]]}),this.nameErrorText$=this.postForm.events.pipe(B(t=>t instanceof it||t instanceof et),V(()=>{var t,e,i,p;return(t=this.postNameControl)!=null&&t.errors&&((e=this.postNameControl)!=null&&e.errors.required)?"This field is required":(i=this.postNameControl)!=null&&i.errors&&((p=this.postNameControl)!=null&&p.errors.minlength)?`Name should have at least ${this.NAME_MIN_LENGTH} characters`:""})),this.nameErrorText=C(this.nameErrorText$),this.descriptionErrorText=`Description should have less than ${this.DESCRIPTION_MAX_LENGTH} characters`}ngOnInit(){var t,e,i;this.post&&((t=this.postNameControl)==null||t.setValue(this.post.name),(i=this.postDescriptionControl)==null||i.setValue((e=this.post.description)!=null?e:""))}get postNameControl(){return this.postForm.get("name")}get postDescriptionControl(){return this.postForm.get("description")}cancel(){this.modalCtrl.dismiss()}onSubmit(){var t;(t=this.post)!=null&&t.id?this.topicService.editPost(this.topicId,O(D({},this.post),{name:this.postForm.value.name,description:this.postForm.value.description})):this.topicService.addPost(this.topicId,{name:this.postForm.value.name,description:this.postForm.value.description}),this.modalCtrl.dismiss()}};n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=T({type:n,selectors:[["app-create-post"]],decls:14,vars:8,consts:[[3,"ngSubmit","formGroup"],["slot","start"],["color","medium",3,"click"],["slot","end"],["type","submit",3,"disabled","strong"],[1,"ion-padding",3,"fullscreen"],["formControlName","name","fill","solid","label","Enter post name","labelPlacement","floating","placeholder","Post name",3,"helperText","errorText"],["formControlName","description","fill","solid","label","Enter post description","labelPlacement","floating","placeholder","Post description",3,"helperText","errorText"]],template:function(e,i){e&1&&(r(0,"form",0),_("ngSubmit",function(){return i.onSubmit()}),r(1,"ion-header")(2,"ion-toolbar")(3,"ion-buttons",1)(4,"ion-button",2),_("click",function(){return i.cancel()}),f(5,"Cancel"),s()(),r(6,"ion-title"),f(7,"Welcome"),s(),r(8,"ion-buttons",3)(9,"ion-button",4),f(10,"Confirm"),s()()()(),r(11,"ion-content",5),c(12,"ion-input",6)(13,"ion-input",7),s()()),e&2&&(l("formGroup",i.postForm),a(9),l("disabled",i.postForm.invalid)("strong",!0),a(2),l("fullscreen",!0),a(),l("helperText","Enter a name with at least "+i.NAME_MIN_LENGTH+" characters.")("errorText",i.nameErrorText()),a(),l("helperText","Enter a description with a maximum of "+i.DESCRIPTION_MAX_LENGTH+" characters.")("errorText",i.descriptionErrorText))},dependencies:[S,dt,Ct,Tt,E,pt,Pt,lt,ot,Z,tt,nt,rt],encapsulation:2});let o=n;return o})();var Ht=(o,n)=>n.id,Rt=()=>["/topics"];function Xt(o,n){if(o&1){let m=I();r(0,"ion-button",12),_("click",function(e){v(m);let i=h().$implicit,p=h(2);return b(p.presentPostManagementPopover(e,i,p.topic()))}),c(1,"ion-icon",13),s()}}function jt(o,n){if(o&1){let m=I();r(0,"ion-item",7),N(1,Xt,2,0,"ion-button",9),g(2,"hasPostPermission"),g(3,"async"),g(4,"hasPostPermission"),g(5,"async"),r(6,"ion-label",10),_("click",function(){let e=v(m).$implicit,i=h(2);return b(i.navigateToPost(e.id,i.topicId))}),f(7),s(),r(8,"ion-icon",11),_("click",function(){let e=v(m).$implicit,i=h(2);return b(i.navigateToPost(e.id,i.topicId))}),s()()}if(o&2){let m=n.$implicit,t=h(2);a(),l("ngIf",x(3,6,F(2,2,m,"edit",t.topic()))||x(5,12,F(4,8,m,"delete",t.topic()))),a(6),w(" ",m.name," ")}}function qt(o,n){o&1&&c(0,"ion-img",8)}function zt(o,n){if(o&1&&(r(0,"ion-list"),R(1,jt,9,14,"ion-item",7,Ht,!1,qt,1,0,"ion-img",8),s()),o&2){let m=h();a(),X(m.posts())}}function Wt(o,n){o&1&&(r(0,"ion-list")(1,"ion-list-header"),c(2,"ion-skeleton-text",14),s(),r(3,"ion-item")(4,"ion-thumbnail",15),c(5,"ion-skeleton-text",16),s(),r(6,"ion-label")(7,"h3"),c(8,"ion-skeleton-text",17),s(),r(9,"p"),c(10,"ion-skeleton-text",18),s(),r(11,"p"),c(12,"ion-skeleton-text",19),s()()()()),o&2&&(a(2),l("animated",!0),a(3),l("animated",!0),a(3),l("animated",!0),a(2),l("animated",!0),a(2),l("animated",!0))}function Jt(o,n){if(o&1){let m=I();r(0,"ion-fab",20)(1,"ion-fab-button",21),_("click",function(){v(m);let e=h();return b(e.openModal())}),c(2,"ion-icon",22),s()()}}Nt({addOutline:wt,chevronForward:Dt,ellipsisVertical:Lt,chevronForwardOutline:Ot,chevronBackOutline:Ft});var Se=(()=>{let n=class n{constructor(t){this.router=t,this.topicService=d(k),this.route=d(Q),this.modalCtrl=d(M),this.popoverCtrl=d(It),this.firestore=d(Et),this.authService=d(yt),this.topicId=this.route.snapshot.params.id,this.topic=C(this.topicService.getById(this.topicId),{initialValue:null}),this.loading=G(!0),this.postsCollection=Mt(this.firestore,`topics/${this.topicId}/posts`),this.posts=C(this.getAllPosts().pipe($(()=>this.loading.set(!1))))}ngOnInit(){this.canEdit$=this.topicService.getById(this.topicId).pipe(A(t=>t?this.authService.canPerformAction(t,kt.WRITE):L(!1)))}getAllPosts(){return this.loading.set(!0),St(this.postsCollection,{idField:"id"})}openModal(t){return y(this,null,function*(){let e=yield this.modalCtrl.create({component:$t,componentProps:{topicId:this.topicId,post:t}});yield e.present(),yield e.onDidDismiss()})}presentPostManagementPopover(t,e,i){return y(this,null,function*(){let p=yield this.popoverCtrl.create({component:Bt,event:t,componentProps:{topic:i,post:e}});yield p.present();let{data:u}=yield p.onDidDismiss();(u==null?void 0:u.action)==="remove"?this.topicService.removePost(this.topicId,e):(u==null?void 0:u.action)==="edit"&&this.openModal(e)})}navigateToPost(t,e){this.router.navigate(["/topics",e,"posts",t])}};n.\u0275fac=function(e){return new(e||n)(H(U))},n.\u0275cmp=T({type:n,selectors:[["app-topic-details"]],decls:13,vars:9,consts:[["loadingTemplate",""],[3,"fullscreen"],["lines","none",1,"back-button",3,"routerLink"],["slot","start","name","chevron-back-outline"],[1,"title-book"],[4,"ngIf","ngIfElse"],["slot","fixed","vertical","bottom","horizontal","end",4,"ngIf"],["lines","none",1,"bg-gradient"],["src","assets/img/no_data.svg","alt","No data",1,"image"],["slot","start","fill","clear","id","click-trigger","aria-label","open post management popover","data-cy","open-post-management-popover",3,"click",4,"ngIf"],[1,"clickable-label",3,"click"],["slot","end","name","chevron-forward-outline",3,"click"],["slot","start","fill","clear","id","click-trigger","aria-label","open post management popover","data-cy","open-post-management-popover",3,"click"],["slot","icon-only","color","medium","name","ellipsis-vertical"],[2,"width","80px",3,"animated"],["slot","start"],[3,"animated"],[2,"width","80%",3,"animated"],[2,"width","60%",3,"animated"],[2,"width","30%",3,"animated"],["slot","fixed","vertical","bottom","horizontal","end"],["data-cy","open-create-post-modal-button","aria-label","open add post modal",3,"click"],["name","add-outline",1,"add-outline-icon"]],template:function(e,i){if(e&1&&(c(0,"header-component"),r(1,"ion-content",1)(2,"ion-item",2),c(3,"ion-icon",3),r(4,"ion-label"),f(5,"Back to Book List"),s()(),r(6,"h1",4),f(7),s(),N(8,zt,4,1,"ion-list",5)(9,Wt,13,5,"ng-template",null,0,z)(11,Jt,3,0,"ion-fab",6),g(12,"async"),s()),e&2){let p,u=j(10);a(),l("fullscreen",!0),a(),l("routerLink",q(8,Rt)),a(5),w("Book: ",(p=i.topic())==null?null:p.name,""),a(),l("ngIf",!i.loading())("ngIfElse",u),a(3),l("ngIf",x(12,6,i.canEdit$))}},dependencies:[K,W,J,st,At,Y,S,E,xt,ft,_t,ut,gt,vt,ct,mt,ht,bt,Vt],styles:["ion-item.bg-gradient[_ngcontent-%COMP%]{background:transparent;border-color:transparent;margin:12px 8px}ion-item.bg-gradient[_ngcontent-%COMP%]::part(native){background:linear-gradient(135deg,#9f7aea,#b3dbff);border-radius:12px;padding:8px 16px}ion-item.bg-gradient[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{color:#2d3748}ion-item.bg-gradient[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%], ion-item.bg-gradient[_ngcontent-%COMP%]   ion-card-subtitle[_ngcontent-%COMP%]{color:inherit}.image[_ngcontent-%COMP%]::part(image){width:50%;margin:auto}.loading-spinner[_ngcontent-%COMP%]{display:block;margin:50px auto auto}.title-book[_ngcontent-%COMP%]{margin-left:12px}"]});let o=n;return o})();export{Se as TopicDetailsPage};
